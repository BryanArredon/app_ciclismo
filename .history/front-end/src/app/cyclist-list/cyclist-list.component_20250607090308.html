<div class="container mt-4">
    <div class="card">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h2 class="mb-0">Lista de Ciclistas</h2>
            <button class="btn btn-light" (click)="openAddModal()">
                <i class="bi bi-plus-circle me-2"></i>Nuevo Ciclista
            </button>
        </div>

        <div class="card-body">
            <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show" role="alert">
                {{ errorMessage }}
                <button type="button" class="btn-close" (click)="errorMessage = null"></button>
            </div>

            <div *ngIf="isLoading" class="d-flex justify-content-center p-4">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>

            <div *ngIf="cyclists.length === 0 && !isLoading" class="text-center p-4">
                <i class="bi bi-inbox display-1 text-muted"></i>
                <p class="lead mt-3">No hay ciclistas registrados</p>
            </div>

            <div *ngIf="cyclists.length > 0" class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Nombre</th>
                            <th>Email</th>
                            <th>Nivel</th>
                            <th>Bicicleta</th>
                            <th>Fecha Registro</th>
                            <th class="text-center">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let cyclist of cyclists">
                            <td>{{ cyclist.nombre }}</td>
                            <td>{{ cyclist.email }}</td>
                            <td>
                                <span class="badge" 
                                    [ngClass]="{
                                        'bg-success': cyclist.nivel === 'avanzado',
                                        'bg-warning': cyclist.nivel === 'intermedio',
                                        'bg-info': cyclist.nivel === 'principiante'
                                    }">
                                    {{ cyclist.nivel }}
                                </span>
                            </td>
                            <td>{{ cyclist.bicicleta }}</td>
                            <td>{{ cyclist.fecha_registro | date:'dd/MM/yyyy' }}</td>
                            <td class="text-center">
                                <button class="btn btn-sm btn-info me-2" (click)="editCyclist(cyclist)" title="Editar">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-sm btn-danger" (click)="cyclist._id && deleteCyclist(cyclist._id)" title="Eliminar">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div *ngIf="showModal" class="modal fade show d-block" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">{{ isEditing ? 'Editar Ciclista' : 'Nuevo Ciclista' }}</h5>
                <button type="button" class="btn-close btn-close-white" (click)="closeModal()"></button>
            </div>
            <div class="modal-body">
                <form [formGroup]="cyclistForm">
                    <div class="mb-3">
                        <label for="nombre" class="form-label">Nombre</label>
                        <input type="text" 
                               class="form-control" 
                               id="nombre" 
                               formControlName="nombre"
                               [ngClass]="{'is-invalid': cyclistForm.get('nombre')?.invalid && cyclistForm.get('nombre')?.touched}">
                        <div *ngIf="cyclistForm.get('nombre')?.invalid && cyclistForm.get('nombre')?.touched" class="invalid-feedback">
                            <div *ngIf="cyclistForm.get('nombre')?.errors?.['required']">
                                El nombre es requerido
                            </div>
                            <div *ngIf="cyclistForm.get('nombre')?.errors?.['minlength']">
                                El nombre debe tener al menos 3 caracteres
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" 
                               class="form-control" 
                               id="email" 
                               formControlName="email"
                               [ngClass]="{'is-invalid': cyclistForm.get('email')?.invalid && cyclistForm.get('email')?.touched}">
                        <div *ngIf="cyclistForm.get('email')?.invalid && cyclistForm.get('email')?.touched" class="invalid-feedback">
                            <div *ngIf="cyclistForm.get('email')?.errors?.['required']">
                                El email es requerido
                            </div>
                            <div *ngIf="cyclistForm.get('email')?.errors?.['email']">
                                Ingrese un email v√°lido
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="nivel" class="form-label">Nivel</label>
                        <select class="form-select" 
                                id="nivel" 
                                formControlName="nivel">
                            <option value="principiante">Principiante</option>
                            <option value="intermedio">Intermedio</option>
                            <option value="avanzado">Avanzado</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="bicicleta" class="form-label">Bicicleta</label>
                        <input type="text" 
                               class="form-control" 
                               id="bicicleta" 
                               formControlName="bicicleta"
                               [ngClass]="{'is-invalid': cyclistForm.get('bicicleta')?.invalid && cyclistForm.get('bicicleta')?.touched}">
                        <div *ngIf="cyclistForm.get('bicicleta')?.invalid && cyclistForm.get('bicicleta')?.touched" class="invalid-feedback">
                            <div *ngIf="cyclistForm.get('bicicleta')?.errors?.['required']">
                                La bicicleta es requerida
                            </div>
                            <div *ngIf="cyclistForm.get('bicicleta')?.errors?.['minlength']">
                                El nombre de la bicicleta debe tener al menos 2 caracteres
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="closeModal()">
                    <i class="bi bi-x-circle me-2"></i>Cancelar
                </button>
                <button type="button" 
                        class="btn btn-primary" 
                        (click)="saveCyclist()" 
                        [disabled]="!cyclistForm.valid || isLoading">
                    <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
                    <i class="bi" [ngClass]="isEditing ? 'bi-check-circle' : 'bi-save'"></i>
                    {{ isEditing ? 'Actualizar' : 'Guardar' }}
                </button>
            </div>
        </div>
    </div>
</div>
<div *ngIf="showModal" class="modal-backdrop fade show"></div>
